{% extends "base.html" %}

{% block title %}ä»»åŠ¡ç®¡ç†{% endblock %}

{% block content %}
<h2 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“‹ é‡‡é›†ä»»åŠ¡ç®¡ç†</h2>

<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>ä»»åŠ¡ ID</th>
                <th>è®¾å¤‡åç§°</th>
                <th>è®¾å¤‡ IP</th>
                <th>ä»»åŠ¡ç±»å‹</th>
                <th>çŠ¶æ€</th>
                <th>å¼€å§‹æ—¶é—´</th>
                <th>å®Œæˆæ—¶é—´</th>
                <th>è€—æ—¶</th>
                <th>æ—¥å¿—æ–‡ä»¶</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% if tasks %}
                {% for task in tasks %}
                <tr>
                    <td><strong>#{{ task.id }}</strong></td>
                    <td>{{ task.device_name }}</td>
                    <td>{{ task.mgmt_ip }}</td>
                    <td>
                        {% if task.task_type == 'manual' %}
                            <span class="badge badge-info">æ‰‹åŠ¨</span>
                        {% elif task.task_type == 'scheduled' %}
                            <span class="badge badge-primary">å®šæ—¶</span>
                        {% else %}
                            <span class="badge badge-secondary">è‡ªåŠ¨</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if task.status == 'pending' %}
                            <span class="badge badge-secondary">å¾…æ‰§è¡Œ</span>
                        {% elif task.status == 'running' %}
                            <span class="badge badge-primary">æ‰§è¡Œä¸­</span>
                        {% elif task.status == 'success' %}
                            <span class="badge badge-success">æˆåŠŸ</span>
                        {% else %}
                            <span class="badge badge-danger">å¤±è´¥</span>
                        {% endif %}
                    </td>
                    <td>{{ task.started_at[:19] if task.started_at else '-' }}</td>
                    <td>{{ task.completed_at[:19] if task.completed_at else '-' }}</td>
                    <td>
                        {% if task.started_at and task.completed_at %}
                            {{ ((task.completed_at | int) - (task.started_at | int)) }}s
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if task.log_file_path %}
                            <a href="{{ task.log_file_path }}" style="color: #1890ff;">ğŸ“„ æŸ¥çœ‹</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if task.status == 'pending' %}
                            <form method="POST" action="{{ url_for('execute_task', task_id=task.id) }}" 
                                  style="display: inline;">
                                <button type="submit" class="btn btn-sm" 
                                        style="background: #52c41a; color: white;">æ‰§è¡Œ</button>
                            </form>
                        {% elif task.status == 'failed' %}
                            <span style="color: #999; font-size: 12px;" 
                                  title="{{ task.error_message }}">âš ï¸ æŸ¥çœ‹é”™è¯¯</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="10" style="text-align: center; padding: 40px; color: #999;">
                        æš‚æ— ä»»åŠ¡è®°å½•
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<div style="margin-top: 20px; padding: 15px; background: #f0f7ff; border-left: 4px solid #1890ff; border-radius: 4px;">
    <strong>ğŸ’¡ è¯´æ˜ï¼š</strong>
    <ul style="margin: 10px 0 0 20px; color: #666;">
        <li><strong>æ‰‹åŠ¨ä»»åŠ¡ï¼š</strong>åœ¨è®¾å¤‡ç®¡ç†é¡µé¢ç‚¹å‡»"é‡‡é›†"æŒ‰é’®åˆ›å»º</li>
        <li><strong>å®šæ—¶ä»»åŠ¡ï¼š</strong>é€šè¿‡ä»»åŠ¡è°ƒåº¦ç³»ç»ŸæŒ‰è®¡åˆ’æ‰§è¡Œ</li>
        <li><strong>è‡ªåŠ¨ä»»åŠ¡ï¼š</strong>è®¾å¤‡å¯ç”¨è‡ªåŠ¨é‡‡é›†åè‡ªåŠ¨åˆ›å»º</li>
        <li><strong>æ—¥å¿—æ–‡ä»¶ï¼š</strong>é‡‡é›†æˆåŠŸåä¼šä¿å­˜åˆ° data/raw/ ç›®å½•ï¼Œå¯ç›´æ¥å¯¼å…¥è§£æ</li>
    </ul>
</div>
{% endblock %}

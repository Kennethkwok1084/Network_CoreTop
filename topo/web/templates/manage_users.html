{% extends "base.html" %}

{% block title %}ç”¨æˆ·ç®¡ç†{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="color: #2c3e50; margin: 0;">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
    <button onclick="document.getElementById('addUserModal').style.display='block'" class="btn btn-primary">â•
        æ·»åŠ ç”¨æˆ·</button>
</div>

<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>ç”¨æˆ·å</th>
                <th>é‚®ç®±</th>
                <th>è§’è‰²</th>
                <th>çŠ¶æ€</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>æœ€åç™»å½•</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td><strong>{{ user.username }}</strong></td>
                <td>{{ user.email or '-' }}</td>
                <td>
                    {% if user.role == 'admin' %}
                    <span class="badge badge-danger">ç®¡ç†å‘˜</span>
                    {% elif user.role == 'user' %}
                    <span class="badge badge-primary">ç”¨æˆ·</span>
                    {% else %}
                    <span class="badge badge-secondary">è®¿å®¢</span>
                    {% endif %}
                </td>
                <td>
                    {% if user.is_active %}
                    <span class="badge badge-success">æ´»åŠ¨</span>
                    {% else %}
                    <span class="badge badge-secondary">åœç”¨</span>
                    {% endif %}
                </td>
                <td>{{ user.created_at[:10] if user.created_at else '-' }}</td>
                <td>{{ user.last_login[:19] if user.last_login else 'ä»æœªç™»å½•' }}</td>
                <td>
                    {% if user.id != session.user_id %}
                    <button class="btn btn-sm btn-danger" onclick="if(confirm('ç¡®å®šåœç”¨æ­¤ç”¨æˆ·å—ï¼Ÿ')) { /* TODO */ }">
                        åœç”¨
                    </button>
                    {% else %}
                    <span style="color: #999;">å½“å‰ç”¨æˆ·</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- æ·»åŠ ç”¨æˆ·æ¨¡æ€æ¡† -->
<div id="addUserModal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="background: white; max-width: 500px; margin: 100px auto; padding: 30px; border-radius: 8px;">
        <h3 style="margin-bottom: 20px;">æ·»åŠ æ–°ç”¨æˆ·</h3>

        <form method="POST" action="{{ url_for('add_user') }}">
            <div class="form-group">
                <label>ç”¨æˆ·å *</label>
                <input type="text" name="username" required
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="form-group">
                <label>å¯†ç  *</label>
                <input type="password" name="password" required
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="form-group">
                <label>é‚®ç®±</label>
                <input type="email" name="email"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="form-group">
                <label>è§’è‰² *</label>
                <select name="role" required
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="viewer">è®¿å®¢ï¼ˆåªè¯»ï¼‰</option>
                    <option value="user" selected>ç”¨æˆ·</option>
                    <option value="admin">ç®¡ç†å‘˜</option>
                </select>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">åˆ›å»ºç”¨æˆ·</button>
                <button type="button" class="btn" style="flex: 1; background: #f0f0f0;"
                    onclick="document.getElementById('addUserModal').style.display='none'">å–æ¶ˆ</button>
            </div>
        </form>
    </div>
</div>

<style>
    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #2c3e50;
    }
</style>
{% endblock %}
{% extends "base.html" %}

{% block title %}{{ 'æ·»åŠ è®¾å¤‡' if action == 'add' else 'ç¼–è¾‘è®¾å¤‡' }}{% endblock %}

{% block content %}
<h2 style="color: #2c3e50; margin-bottom: 20px;">
    {{ 'â• æ·»åŠ æ–°è®¾å¤‡' if action == 'add' else 'âœï¸ ç¼–è¾‘è®¾å¤‡' }}
</h2>

<div class="card" style="max-width: 800px;">
    <form method="POST">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- å·¦åˆ— -->
            <div>
                <div class="form-group">
                    <label for="device_name">è®¾å¤‡åç§° *</label>
                    <input type="text" id="device_name" name="device_name"
                        value="{{ device.device_name if device else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="device_type">è®¾å¤‡ç±»å‹ *</label>
                    <select id="device_type" name="device_type" required>
                        <option value="huawei" {% if device and device.device_type=='huawei' %}selected{% endif %}>åä¸º
                            Huawei</option>
                        <option value="cisco" {% if device and device.device_type=='cisco' %}selected{% endif %}>æ€ç§‘
                            Cisco</option>
                        <option value="h3c" {% if device and device.device_type=='h3c' %}selected{% endif %}>åä¸‰ H3C
                        </option>
                        <option value="ruijie" {% if device and device.device_type=='ruijie' %}selected{% endif %}>é”æ·
                            Ruijie</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="model">è®¾å¤‡å‹å·</label>
                    <input type="text" id="model" name="model" value="{{ device.model if device else '' }}"
                        placeholder="ä¾‹å¦‚: S12700E-6">
                </div>

                <div class="form-group">
                    <label for="mgmt_ip">ç®¡ç† IP *</label>
                    <input type="text" id="mgmt_ip" name="mgmt_ip" value="{{ device.mgmt_ip if device else '' }}"
                        placeholder="192.168.1.1" required>
                </div>

                <div class="form-group">
                    <label for="mgmt_port">SSH ç«¯å£</label>
                    <input type="number" id="mgmt_port" name="mgmt_port"
                        value="{{ device.mgmt_port if device else 22 }}" min="1" max="65535">
                </div>
            </div>

            <!-- å³åˆ— -->
            <div>
                <div class="form-group">
                    <label for="username">SSH ç”¨æˆ·å *</label>
                    <input type="text" id="username" name="username" value="{{ device.username if device else '' }}"
                        required>
                </div>

                <div class="form-group">
                    <label for="password">SSH å¯†ç  {{ '*' if action == 'add' else '(ç•™ç©ºä¸ä¿®æ”¹)' }}</label>
                    <input type="password" id="password" name="password" {{ 'required' if action=='add' else '' }}
                        autocomplete="new-password">
                </div>

                <div class="form-group">
                    <label for="enable_password">Enable å¯†ç ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="password" id="enable_password" name="enable_password">
                </div>

                <div class="form-group">
                    <label for="group_name">è®¾å¤‡åˆ†ç»„</label>
                    <input type="text" id="group_name" name="group_name"
                        value="{{ device.group_name if device else '' }}" placeholder="ä¾‹å¦‚: æ ¸å¿ƒäº¤æ¢æœº">
                </div>

                <div class="form-group">
                    <label for="description">å¤‡æ³¨è¯´æ˜</label>
                    <textarea id="description" name="description" rows="3"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">{{ device.description if device else '' }}</textarea>
                </div>
            </div>
        </div>

        <!-- è‡ªåŠ¨é‡‡é›†é…ç½® -->
        <div style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
            <h3 style="color: #2c3e50; margin-bottom: 15px;">è‡ªåŠ¨é‡‡é›†è®¾ç½®</h3>

            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 20px;">
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="auto_collect" name="auto_collect" {% if device and
                            device.auto_collect %}checked{% endif %}>
                        å¯ç”¨è‡ªåŠ¨é‡‡é›†
                    </label>
                </div>

                <div class="form-group">
                    <label for="collect_interval">é‡‡é›†é—´éš”ï¼ˆç§’ï¼‰</label>
                    <input type="number" id="collect_interval" name="collect_interval"
                        value="{{ device.collect_interval if device else 86400 }}" min="3600" step="3600">
                    <small style="color: #999; display: block; margin-top: 5px;">
                        é»˜è®¤ 86400 ç§’ï¼ˆ24å°æ—¶ï¼‰
                    </small>
                </div>
            </div>
        </div>

        <!-- ä¸Šè”é…ç½® -->
        <div style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
            <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ”— ä¸Šè”é…ç½®ï¼ˆå¤šè·³æ‹“æ‰‘ï¼‰</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="uplink_device_id">ä¸Šè”æ ¸å¿ƒäº¤æ¢æœº</label>
                    <select id="uplink_device_id" name="uplink_device_id">
                        <option value="">æ— ï¼ˆä½¿ç”¨LLDPè‡ªåŠ¨å‘ç°ï¼‰</option>
                        {% if core_devices %}
                            {% for core in core_devices %}
                                <option value="{{ core.id }}" 
                                    {% if device and device.uplink_device_id == core.id %}selected{% endif %}>
                                    {{ core.device_name }} ({{ core.mgmt_ip }})
                                </option>
                            {% endfor %}
                        {% endif %}
                    </select>
                    <small style="color: #999; display: block; margin-top: 5px;">
                        é€‰æ‹©æ­¤è®¾å¤‡è¿æ¥åˆ°å“ªä¸ªæ ¸å¿ƒäº¤æ¢æœº
                    </small>
                </div>

                <div class="form-group">
                    <label for="uplink_interface">ä¸Šè”æ¥å£</label>
                    <input type="text" id="uplink_interface" name="uplink_interface" 
                        value="{{ device.uplink_interface if device else '' }}"
                        placeholder="ä¾‹å¦‚: 1/6/0/6 æˆ– GigabitEthernet1/0/1">
                    <small style="color: #999; display: block; margin-top: 5px;">
                        æ ¸å¿ƒäº¤æ¢æœºä¸Šè¿æ¥æ­¤è®¾å¤‡çš„æ¥å£ç¼–å·
                    </small>
                </div>
            </div>

            <div style="background: #e6f7ff; border: 1px solid #91d5ff; border-radius: 4px; padding: 12px; margin-top: 15px;">
                <strong style="color: #1890ff;">ğŸ’¡ è¯´æ˜ï¼š</strong>
                <ul style="margin: 8px 0 0 20px; color: #666;">
                    <li>å¦‚æœé€‰æ‹©äº†ä¸Šè”æ ¸å¿ƒäº¤æ¢æœºï¼Œæ‹“æ‰‘å›¾å°†æ˜¾ç¤ºæ­¤è®¾å¤‡ä¸æ ¸å¿ƒçš„æ‰‹åŠ¨è¿æ¥</li>
                    <li>å¦‚æœä¸é€‰æ‹©ï¼Œç³»ç»Ÿå°†é€šè¿‡LLDPè‡ªåŠ¨å‘ç°æ­¤è®¾å¤‡çš„ä¸Šè”å…³ç³»</li>
                    <li>æ‰‹åŠ¨é…ç½®çš„ä¼˜å…ˆçº§é«˜äºLLDPè‡ªåŠ¨å‘ç°</li>
                </ul>
            </div>
        </div>

        <!-- æŒ‰é’® -->
        <div style="margin-top: 30px; display: flex; gap: 10px;">
            <button type="submit" class="btn btn-primary" style="padding: 10px 30px;">
                {{ 'æ·»åŠ è®¾å¤‡' if action == 'add' else 'ä¿å­˜ä¿®æ”¹' }}
            </button>
            <a href="{{ url_for('manage_devices') }}" class="btn"
                style="padding: 10px 30px; background: #f0f0f0; color: #666;">å–æ¶ˆ</a>
        </div>
    </form>
</div>

<style>
    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #2c3e50;
        font-weight: 500;
    }

    .form-group input[type="text"],
    .form-group input[type="password"],
    .form-group input[type="number"],
    .form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #1890ff;
    }
</style>
{% endblock %}